#include "{{ service.name | caseLower }}.hpp"

using string = std::string;
using json = nlohmann::json;

namespace {{ spec.title | caseUcfirst }} {
{% for method in service.methods %}
/*
 * {{ method.title }}
 *
{% if method.description %}
{{ method.description | comment1 }}
{% endif %}
{% for parameter in method.parameters.all %}
 * @param {{ parameter.type | typeName }} {{ parameter.name | caseCamel | escapeKeyword }}
{% endfor %}
 * @throws {{spec.title | caseUcfirst}}Exception
 * @return {% if method.type == "location" %}string{% else %}array{% endif %}

 */
{% if method.type == "location" %}string{% else %}json{% endif %} {{ service.name | caseUcfirst }}::{{ method.name | caseCamel | escapeKeyword }}({% for parameter in method.parameters.all %}{{ parameter.type | typeName }} {{ parameter.name | caseCamel | escapeKeyword }}{% if not loop.last %}, {% endif %}{% endfor %}) {
    cpr::Payload params = {
{% for parameter in method.parameters.query %}
{% if parameter.type == 'integer' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
{% elseif parameter.type == 'boolean' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
{% else %}
        {{ '{' }}"{{ parameter.name }}", {{ parameter.name | caseCamel | escapeKeyword }}{{ '}' }},
{% endif %}
{% endfor %}
{% for parameter in method.parameters.body %}
{% if parameter.type == 'integer' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
{% elseif parameter.type == 'boolean' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
 {% else %}
        {{ '{' }}"{{ parameter.name }}", {{ parameter.name | caseCamel | escapeKeyword }}{{ '}' }},
{% endif %}
{% endfor %}
{% for parameter in method.parameters.formData %}
{% if parameter.type == 'integer' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
{% elseif parameter.type == 'boolean' %}
        {{ '{' }}"{{ parameter.name }}", std::to_string({{ parameter.name | caseCamel | escapeKeyword }}){{ '}' }},
 {% else %}
        {{ '{' }}"{{ parameter.name }}", {{ parameter.name | caseCamel | escapeKeyword }}{{ '}' }},    
{% endif %}
{% endfor %}
    };

{# 
{% if parameter.type == 'integer' %}
{{parameter.name}} = {{parameter.name}}.toString();
{% endif %}
 #}

    cpr::Header headers = {
{% for parameter in method.parameters.header %}
        {{ '{' }}"{{ parameter.name }}", {{ parameter.name | caseCamel | escapeKeyword }}{{ '}' }},
{% endfor %}
{% for key, header in method.headers %}
        {{ '{' }}"{{ key }}", "{{ header }}"{{ '}' }},
{% endfor %}
    };
    string path = "{{ method.path }}";
    size_t pos;
    string searchString;
{% for parameter in method.parameters.path %}
    searchString = "{{ '{' }}{{ parameter.name | caseCamel }}{{ '}' }}";
    pos = path.find(searchString);
    if (pos != std::string::npos)
        path = path.replace(pos, searchString.length(), "{{ parameter.name | caseCamel | escapeKeyword }}");
{% endfor %}

    return this->client.call(Client::METHOD_{{ method.method | caseUpper }},  headers, params,path);
}
{% if not loop.last %}

{% endif %}
{% endfor %}
} // namespace {{ spec.title | caseUcfirst }}
